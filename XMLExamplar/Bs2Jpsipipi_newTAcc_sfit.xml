<RapidFit>

	//================================================
	// Formal Parameters to be fitted or fixed

	<ParameterSet>
		
		<PhysicsParameter>
		<Name>SignalFractionBU</Name>
		<Value>0.8314</Value>
		<Minimum>0.0</Minimum>
		<Maximum>1.0</Maximum>
		<Type>Fixed</Type>
		<Unit>Unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
		<Name>SignalFractionBT</Name>
		<Value>0.7694</Value>
		<Minimum>0.0</Minimum>
		<Maximum>1.0</Maximum>
		<Type>Fixed</Type>
		<Unit>Unitless</Unit>
		</PhysicsParameter>
	
		<PhysicsParameter>
		<Name>alphaM_pr</Name>
		<Value>0.000535</Value>
		<Type>Fixed</Type>
		<Unit>Unitless</Unit>
		</PhysicsParameter>
	
		<PhysicsParameter>
		<Name>f_sig_m1</Name>
		<Value>0.804</Value>
		<Minimum>0.7</Minimum>
		<Maximum>1.0</Maximum>
		<Type>Fixed</Type>
		<Unit>Unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
		<Name>sigma_m1</Name>
		<Value>8.11</Value>
		<Minimum>0.0</Minimum>
		<Maximum>10.0</Maximum>
		<Type>Fixed</Type>
		<Unit>MeV/c^{2}</Unit>
		</PhysicsParameter>
				
		<PhysicsParameter>
		<Name>ratio_21</Name>
		<Value>2.22</Value>
		<Minimum>0.0</Minimum>
		<Maximum>10.0</Maximum>
		<Type>Fixed</Type>
		<Unit>MeV/c^{2}</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
		<Name>m_Bs</Name>
		<Value>5368.21</Value>
		<Type>Fixed</Type>
		<Unit>MeV/c^{2}</Unit>
		</PhysicsParameter>

		//Long lived background - just need one exponential
		<PhysicsParameter>
		<Name>f_LL1</Name>
		<Value>0.94</Value>
		<Minimum>0.92</Minimum>
		<Maximum>0.96</Maximum>
		<Type>Fixed</Type>
		<Unit>Unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
		<Name>tau_LL1</Name>
		<Value>0.65</Value>
		<Minimum>0.6</Minimum>
		<Maximum>0.7</Maximum>
		<Type>Fixed</Type>
		<Unit>Unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
		<Name>tau_LL2</Name>
		<Value>2.0</Value>
		<Minimum>1.2</Minimum>
		<Maximum>2.8</Maximum>
		<Type>Fixed</Type>
		<Unit>Unitless</Unit>
		</PhysicsParameter>


		<PhysicsParameter>
			<Name>gamma</Name>
			<Value>0.656</Value>
			<Minimum>0.0</Minimum>
			<Maximum>2.0</Maximum>
			<Type>Free</Type>
			<Unit>ps^{-1}</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>deltaGamma</Name>
			<Value>0.123</Value>
			<Minimum>-0.1</Minimum>
			<Maximum>0.3</Maximum>
			<Type>Free</Type>
			<Unit>ps^{-1}</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>Aperp_sq</Name>
			<Value>1.0</Value>
			<Type>Fixed</Type>
			<Unit>Unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>Azero_sq</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit>Unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>delta_para</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit>Unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>delta_perp</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit>Unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>delta_zero</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit>Unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>F_s</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit>Unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>delta_s</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit>Unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>Csp</Name>
			<Value>1.0</Value>
			<Type>Fixed</Type>
			<Unit>Unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>deltaM</Name>
			<Value>17.63</Value>
			<Type>Free</Type>
			<Unit>ps-1</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>Phi_s</Name>
			<Value>0.25</Value>
			<Minimum>-3.14159</Minimum>
			<Maximum>3.14159</Maximum>
			<Type>Free</Type>
			<Unit>Unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>lambda</Name>
			<Value>1.0</Value>
			<Type>Fixed</Type>
			<Unit>Unitless</Unit>
		</PhysicsParameter>



		//..................................
		// Detector Parameters

		//Signal PDF time resolution parameters for double gaussian model.

		<PhysicsParameter>
			<Name>timeResolutionScale</Name>
			<Value>1.0</Value>
			<Type>Free</Type>
			<Unit>unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>timeResolution1</Name>
			<Value>0.031</Value>
			<Type>Fixed</Type>
			<Unit>ps</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>timeResolution2</Name>
			<Value>0.059</Value>
			<Type>Fixed</Type>
			<Unit>ps</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>timeResolution3</Name>
			<Value>0.423</Value>
			<Type>Fixed</Type>
			<Unit>ps</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>timeResolution2Fraction</Name>
			<Value>0.245</Value>
			<Type>Fixed</Type>
			<Unit>unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>timeResolution3Fraction</Name>
			<Value>0.012</Value>
			<Type>Fixed</Type>
			<Unit>unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
			<Name>timeOffset</Name>   //Leave at Zero, this is not used anywhere yet.
			<Value>0.000</Value>
			<Type>Fixed</Type>
			<Unit>ps</Unit>
		</PhysicsParameter>



		// Mistag parameters

		// Mistag calibration
		<PhysicsParameter>
			<Name>mistagP1_OS</Name>
			<Value>1.00</Value>
			<Type>Free</Type>
			<Unit> </Unit>
		</PhysicsParameter>
		<PhysicsParameter>
			<Name>mistagP0_OS</Name>
			<Value>0.392</Value>
			<Type>Free</Type>
			<Unit> </Unit>
		</PhysicsParameter>
		<PhysicsParameter>
			<Name>mistagSetPoint_OS</Name>
			<Value>0.392</Value>
			<Type>Fixed</Type>
			<Unit> </Unit>
		</PhysicsParameter>
		<PhysicsParameter>
			<Name>mistagDeltaP1_OS</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit> </Unit>
		</PhysicsParameter>
		<PhysicsParameter>
			<Name>mistagDeltaP0_OS</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit> </Unit>
		</PhysicsParameter>
		<PhysicsParameter>
			<Name>mistagDeltaSetPoint_OS</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit> </Unit>
		</PhysicsParameter>

		// Mistag calibration
		<PhysicsParameter>
			<Name>mistagP1_SS</Name>
			<Value>1.000</Value>
			<Type>Free</Type>
			<Unit> </Unit>
		</PhysicsParameter>
		<PhysicsParameter>
			<Name>mistagP0_SS</Name>
			<Value>0.350</Value>
			<Type>Free</Type>
			<Unit> </Unit>
		</PhysicsParameter>
		<PhysicsParameter>
			<Name>mistagSetPoint_SS</Name>
			<Value>0.350</Value>
			<Type>Fixed</Type>
			<Unit> </Unit>
		</PhysicsParameter>
		<PhysicsParameter>
			<Name>mistagDeltaP1_SS</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit> </Unit>
		</PhysicsParameter>
		<PhysicsParameter>
			<Name>mistagDeltaP0_SS</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit> </Unit>
		</PhysicsParameter>
		<PhysicsParameter>
			<Name>mistagDeltaSetPoint_SS</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit> </Unit>
		</PhysicsParameter>

		// Mistag calibration
		<PhysicsParameter>
			<Name>mistagP1_OSSS</Name>
			<Value>1.000</Value>
			<Type>Fixed</Type>
			<Unit> </Unit>
		</PhysicsParameter>
		<PhysicsParameter>
			<Name>mistagP0_OSSS</Name>
			<Value>0.0</Value>
			<Type>Free</Type>
			<Unit> </Unit>
		</PhysicsParameter>
		<PhysicsParameter>
			<Name>mistagSetPoint_OSSS</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit> </Unit>
		</PhysicsParameter>
		<PhysicsParameter>
			<Name>mistagDeltaP1_OSSS</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit> </Unit>
		</PhysicsParameter>
		<PhysicsParameter>
			<Name>mistagDeltaP0_OSSS</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit> </Unit>
		</PhysicsParameter>
		<PhysicsParameter>
			<Name>mistagDeltaSetPoint_OSSS</Name>
			<Value>0.0</Value>
			<Type>Fixed</Type>
			<Unit> </Unit>
		</PhysicsParameter>

		// Background Model
		// Long lived time resolution components

		<PhysicsParameter>
		<Name>timeResLL1Frac</Name>
		<Value>1.0</Value>
		<Type>Fixed</Type>
		<Unit>Unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
		<Name>sigma_LL1</Name>
		<Value>0.0398</Value>
		<Type>Fixed</Type>
		<Unit>Unitless</Unit>
		</PhysicsParameter>

		<PhysicsParameter>
		<Name>sigma_LL2</Name>
		<Value>3.93</Value>
		<Type>Fixed</Type>
		<Unit>Unitless</Unit>
		</PhysicsParameter>


	</ParameterSet>


	//==========================================
	// Specify which minimiser to use.

	<Minimiser>
		<MinimiserName>Minuit</MinimiserName>
		#<MaxSteps>100000</MaxSteps>
		<GradTolerance>0.0001</GradTolerance>
		<Quality>1</Quality>
	</Minimiser>

	<FitFunction>
	<WeightName>sWeight</WeightName>
	<FunctionName>NegativeLogLikelihoodThreaded</FunctionName>
	<Threads>5</Threads>
	<SetIntegratorTest>False</SetIntegratorTest>
	</FitFunction>

	<NumberRepeats>1</NumberRepeats>



	//==========================================
	// Specify the fit

	//...................................
	// This applies a constraint on deltaM
	<ToFit>
		<ConstraintFunction>
			<ExternalConstraint>
				<Name>deltaM</Name>
				<Value>17.63</Value>
				<Error>0.11</Error>
			</ExternalConstraint>
		</ConstraintFunction>
	</ToFit>

	<ToFit>
		<ConstraintFunction>
			<ExternalConstraint>
				<Name>timeResolutionScale</Name>
				<Value>1.0</Value>
				<Error>0.02</Error>
			</ExternalConstraint>
		</ConstraintFunction>
	</ToFit>

	// This applies a constraint on mistag scale

	<ToFit>
		<ConstraintFunction>
			<ExternalConstraint>
				<Name>mistagP1_OS</Name>
				<Value>1.000</Value>
				<Error>0.023</Error>
			</ExternalConstraint>
		</ConstraintFunction>
	</ToFit>
	<ToFit>
		<ConstraintFunction>
			<ExternalConstraint>
				<Name>mistagP0_OS</Name>
				<Value>0.392</Value>
				<Error>0.008</Error>
			</ExternalConstraint>
		</ConstraintFunction>
	</ToFit>
	<ToFit>
		<ConstraintFunction>
			<ExternalConstraint>
				<Name>mistagDeltaP0_OS</Name>
				<Value>0.011</Value>
				<Error>0.0034</Error>
			</ExternalConstraint>
		</ConstraintFunction>
	</ToFit>

	<ToFit>
		<ConstraintFunction>
			<ExternalConstraint>
				<Name>mistagP1_SS</Name>
				<Value>1.000</Value>
				<Error>0.14</Error>
			</ExternalConstraint>
		</ConstraintFunction>
	</ToFit>
	<ToFit>
		<ConstraintFunction>
			<ExternalConstraint>
				<Name>mistagP0_SS</Name>
				<Value>0.350</Value>
				<Error>0.017</Error>
			</ExternalConstraint>
		</ConstraintFunction>
	</ToFit>
	<ToFit>
		<ConstraintFunction>
			<ExternalConstraint>
				<Name>mistagDeltaP0_SS</Name>
				<Value>-0.019</Value>
				<Error>0.005</Error>
			</ExternalConstraint>
		</ConstraintFunction>
	</ToFit>

	<ToFit>
		<ConstraintFunction>
			<ExternalConstraint>
				<Name>mistagP0_OSSS</Name>
				<Value>0.000</Value>
				<Error>0.025</Error>
			</ExternalConstraint>
		</ConstraintFunction>
	</ToFit>
	<ToFit>
		<ConstraintFunction>
			<ExternalConstraint>
				<Name>mistagDeltaP0_OSSS</Name>
				<Value>-0.011</Value>
				<Error>0.004</Error>
			</ExternalConstraint>
		</ConstraintFunction>
	</ToFit>

	<ToFit>
	<ConstraintFunction>
	<ExternalConstraint>
	<Name>SpecialForGreig</Name>
	<Value>0.0</Value>
	<Error>0.</Error>
	</ExternalConstraint>
	</ConstraintFunction>
	</ToFit>


	// ....................
	// Attempt to constrain LLscan on the amplitudes



//===============================================================================================
//===============================================================================================
//===============================================================================================
//===============================================================================================
// The commonpdf and phase space to all segments

	<CommonPDF>
		<PDF>
		<Name>Bs2Jpsifzero_Signal_v5</Name>
			<ConfigurationParameter>UseHelicityBasis:True</ConfigurationParameter>
			<ConfigurationParameter>UseTimeAcceptance:True</ConfigurationParameter>
			<ConfigurationParameter>TimeAcceptanceFile:signal_recentsyracuse.txt</ConfigurationParameter>
		</PDF>
	</CommonPDF>

	<CommonPhaseSpace>
		<PhaseSpaceBoundary>
			<Observable>
				<Name>time</Name>
				<TF1>time+0.00294</TF1>
				<Minimum>0.0</Minimum>
				<Maximum>10.0</Maximum>
				<Unit>ps</Unit>
			</Observable>
			<Observable>
				<Name>helcosthetaK</Name>
				<Minimum>-1.0</Minimum>
				<Maximum>1.0</Maximum>
				<Unit> </Unit>
			</Observable>
			<Observable>
				<Name>helphi</Name>
				<TF1>(helphi+TMath::Pi()-(helphi>0.)*(2.*TMath::Pi()))</TF1>
				<Minimum>-3.1416</Minimum>
				<Maximum>3.1416</Maximum>
				<Unit>rad</Unit>
			</Observable>
			<Observable>
				<Name>helcosthetaL</Name>
				<Minimum>-1.0</Minimum>
				<Maximum>1.0</Maximum>
				<Unit> </Unit>
			</Observable>
			<Observable>
				<Name>mass</Name>
				#<TF1>m</TF1>
				<Minimum>5346.3</Minimum>
				<Maximum>5386.3</Maximum>
				<Unit>MeV/c^{2}</Unit>
			</Observable>
			<Observable>
				<Name>tag</Name>
				#<TF1>tagdecision</TF1>
				<Value>1.</Value>
				<Value>-1.</Value>
				<Unit> </Unit>
			</Observable>
			<Observable>
				<Name>mistag</Name>
				#<TF1>tagomega</TF1>
				<Minimum>0.0</Minimum>
				<Maximum>0.5</Maximum>
				<Unit> </Unit>
			</Observable>
			<Observable>
				<Name>sWeight</Name>
				<TF1>sWeight*0.290372884513</TF1>
				<Minimum>-50.0</Minimum>
				<Maximum>50.0</Maximum>
				<Unit> </Unit>
			</Observable>
#			<Observable>
#				<Name>eventResolution</Name>
#				<TF1>sigmat</TF1>
#				<Minimum>0.0</Minimum>
#				<Maximum>0.12</Maximum>
#				<Unit> </Unit>
#			</Observable>
		</PhaseSpaceBoundary>
	</CommonPhaseSpace>



	//===============================================================================================
	//===============================================================================================
	//===============================================================================================
	//===============================================================================================
	// UN-TAGGED events 

	<ToFit>

		<CommonPDF>True</CommonPDF>
		<PDFConfigurator>
			<FractionName>SignalFractionBU</FractionName>
			<AppendParameterNames>mistagP0:mistagP1:mistagSetPoint:mistagDeltaP0:mistagDeltaP1:mistagDeltaSetPoint:_OS</AppendParameterNames>
		</PDFConfigurator>
		<DataSet>
			<Source>File</Source>
			<FileName>$HOME/Bs2Jpsipipi/data_files/Bs2Jpsipipi_stripping17_sweight_ut.root</FileName>
			#<CutString>(tagdecision_os==0)&&(tagdecision_ssk==0)</CutString>
			<NumberEvents>10000000</NumberEvents>

			<CommonPhaseSpace>
				<Observable>
					<Name>tag</Name>
					#<TF1>tagdecision</TF1>
					<Value>0.</Value>
					<Unit> </Unit>
				</Observable>
			</CommonPhaseSpace>

		</DataSet>
	</ToFit>

	//========================================
	// OS TAGGED events

	<ToFit>
		<CommonPDF>True</CommonPDF>
		<PDFConfigurator>
			<FractionName>SignalFractionBT</FractionName>
			<AppendParameterNames>mistagP0:mistagP1:mistagSetPoint:mistagDeltaP0:mistagDeltaP1:mistagDeltaSetPoint:_OS</AppendParameterNames>
		</PDFConfigurator>
		<DataSet>
			<Source>File</Source>
			<FileName>$HOME/Bs2Jpsipipi/data_files/Bs2Jpsipipi_stripping17_sweight_os.root</FileName>
			#<CutString>(tagdecision_os!=0)&&(tagdecision_ssk==0)&&(sel==1)&&(t>0)</CutString>
			<NumberEvents>10000000</NumberEvents>

			<CommonPhaseSpace>
			</CommonPhaseSpace>

		</DataSet>
	</ToFit>

	//========================================
	// SS TAGGED events

	<ToFit>
		<CommonPDF>True</CommonPDF>
		<PDFConfigurator>
			<FractionName>SignalFractionBT</FractionName>
			<AppendParameterNames>mistagP0:mistagP1:mistagSetPoint:mistagDeltaP0:mistagDeltaP1:mistagDeltaSetPoint:_SS</AppendParameterNames>
		</PDFConfigurator>
		<DataSet>
			<Source>File</Source>
			<FileName>$HOME/Bs2Jpsipipi/data_files/Bs2Jpsipipi_stripping17_sweight_ss.root</FileName>
			#<CutString>(tagdecision_os==0)&&(tagdecision_ssk!=0)&&(sel==1)&&(t>0)</CutString>
			<NumberEvents>10000000</NumberEvents>

			<CommonPhaseSpace>
			</CommonPhaseSpace>

		</DataSet>
	</ToFit>

	//========================================
	// OS+SS TAGGED events

	<ToFit>
		<CommonPDF>True</CommonPDF>
		<PDFConfigurator>
			<FractionName>SignalFractionBT</FractionName>
			<AppendParameterNames>mistagP0:mistagP1:mistagSetPoint:mistagDeltaP0:mistagDeltaP1:mistagDeltaSetPoint:_OSSS</AppendParameterNames>
		</PDFConfigurator>
		<DataSet>
			<Source>File</Source>
			<FileName>$HOME/Bs2Jpsipipi/data_files/Bs2Jpsipipi_stripping17_sweight_ossk.root</FileName>
			#<CutString>(tagdecision_os!=0)&&(tagdecision_ssk!=0)&&(sel==1)&&(t>0)</CutString>
			<NumberEvents>10000000</NumberEvents>

			<CommonPhaseSpace>
			</CommonPhaseSpace>

		</DataSet>
	</ToFit>
<Output>
#	<Projection>mass</Projection>

<Scan>                                                                                                                                 
<Name>Phi_s</Name>                                                                                                                     
<Minimum>-3.2</Minimum>
<Maximum>3.2</Maximum>
<Points>100</Points>                                                                                                                   
</Scan>


</Output>

</RapidFit>

